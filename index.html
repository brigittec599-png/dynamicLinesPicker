<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Mobile viewport for iPhone compatibility -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Tunnel Dynamic Lines Wheel Picker</title>

  <!-- PWA: Web App Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS: make it behave like an app when added to Home Screen -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Dynamic Lines">

  <!-- iOS app icon (you can replace icon-192.png with your own) -->
  <link rel="apple-touch-icon" href="icon-192.png">

  <!-- Fallback favicon -->
  <link rel="icon" href="icon-192.png">

  <style>
    body {
      font-family: "Garamond", serif;
      margin: 0;
      padding: 20px;
      background: #A3B18A; /* sage green */
      color: #ffffff;       /* white text */
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .subtitle {
      text-align: center;
      font-size: 1rem;
      color: #ffffff;
      margin-top: 25px;
      font-style: italic;
    }

    .wheels-container {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .wheel-card {
      background: #6B705C; /* darker sage */
      border-radius: 16px;
      padding: 16px;
      width: 280px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      border: 1px solid #556050;
    }

    .wheel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .wheel-title {
      font-weight: 600;
      font-size: 1.1rem;
      color: #ffffff;
    }

    .options-list {
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
      margin-bottom: 8px;
    }

    .option-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 3px 0;
    }

    .option-row label {
      font-size: 1rem;
      color: #ffffff;
      word-wrap: break-word;
      white-space: normal;
      line-height: 1.3;
    }

    .result {
      margin-top: 3px;
      font-size: 0.95rem;
      color: #EAF4F4;
      min-height: 1.2em;
    }

    .controls {
      text-align: center;
      margin-top: 18px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 1rem;
      cursor: pointer;
      background: #DAD7CD; /* soft light sage */
      color: #3A3A3A;
      font-weight: 600;
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
      transition: transform 0.08s ease, box-shadow 0.08s ease;
      font-family: "Garamond", serif;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.5);
    }

    /* Visual feedback while spinning */
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    }

    .line-output {
      margin-top: 12px;
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
      color: #ffffff;
    }

    .line-output span {
      display: inline-block;
      margin: 0 4px;
      padding: 3px 10px;
      border-radius: 999px;
      background: #6B705C;
      border: 1px solid #808c74;
      font-size: 1rem;
    }

    .footer-link {
      margin-top: 10px;
      text-align: center;
      font-size: 1rem;
    }

    .footer-link a {
      color: #ffffff;
      text-decoration: underline;
      font-weight: 600;
      font-family: "Garamond", serif;
    }

    button {
      font-family: "Garamond", serif;
    }

    /* ---------- iPhone / small-screen responsiveness ---------- */
    @media (max-width: 600px) {
      .wheel-card {
        width: 90%;
        margin-bottom: 20px;
      }

      .wheels-container {
        flex-direction: column;
        align-items: center;
      }

      .btn {
        width: 90%;
        padding: 14px 0;
        font-size: 1.2rem;
      }

      .line-output span {
        display: block;     /* stack the moves vertically on small screens */
        margin: 6px auto;
        width: fit-content;
      }

      h1 {
        font-size: 1.8rem;
      }

      .subtitle {
        font-size: 1rem;
      }
    }
  </style>
</head>

<body>

<h1>Dynamic Lines Picker</h1>

<!-- Website link at the top -->
<div class="footer-link">
  <a href="https://www.dynamicflying.com/videos/index.html" target="_blank">
    Dynamic Flying Video Library
  </a>
</div>

<div class="subtitle" id="bottom-msg-placeholder"></div>

<div class="wheels-container" id="wheels"></div>

<div class="controls">
  <button class="btn" id="spinButton">✨ Spin ✨</button>
  <div class="line-output" id="lineOutput"></div>
</div>

<!-- Bottom message -->
<div class="subtitle">
  Good luck dont die :D
</div>

<script>
  const wheelsData = [
    {
      id: "wheel1",
      title: "Snakes",
      options: [
        "S1 : HD Snake",
        "S2 : HD Switching Snake",
        "S3 : HU Snake",
        "S4 : HU Switching Snake",
        "S5 : HD Mixed Snake",
        "S6 : HU Mixed Snake",
        "S7 : HD 360 Snake",
        "S8 : HU 360 Snake"
      ]
    },
    {
      id: "wheel2",
      title: "Vertical",
      options: [
        "V1 : Back Layout",
        "V2 : Butterfly",
        "V3 : Classic",
        "V4 : HD 360",
        "V5 : HU 360",
        "V6 : Crossing Classic",
        "V7 : Bottom Loop",
        "V8 : Crossing Layout"
      ]
    },
    {
      id: "wheel3",
      title: "Mixer",
      options: [
        "M1 : HD Circles",
        "M2 : HU Circles",
        "M3: Mixed Circles",
        "M4: Reverse Mixed Circles",
        "M5 : HD Shuffler",
        "M6: HU Shuffler",
        "M7 : Mixed Shuffler",
        "M8 : HD Inface Shuffler",
        "M9 : HU Inface Shuffler"
      ]
    }
  ];

  const wheelsContainer = document.getElementById("wheels");

  wheelsData.forEach(wheel => {
    const card = document.createElement("div");
    card.className = "wheel-card";
    card.dataset.wheelId = wheel.id;

    const header = document.createElement("div");
    header.className = "wheel-header";

    const title = document.createElement("div");
    title.className = "wheel-title";
    title.textContent = wheel.title;

    const selectAllToggle = document.createElement("button");
    selectAllToggle.textContent = "All on";
    selectAllToggle.style.fontSize = "0.8rem";
    selectAllToggle.style.padding = "4px 10px";
    selectAllToggle.style.borderRadius = "999px";
    selectAllToggle.style.border = "1px solid #ccc";
    selectAllToggle.style.background = "#DAD7CD";
    selectAllToggle.style.color = "#333";
    selectAllToggle.style.cursor = "pointer";

    header.appendChild(title);
    header.appendChild(selectAllToggle);

    const optionsList = document.createElement("div");
    optionsList.className = "options-list";

    wheel.options.forEach((move, index) => {
      const row = document.createElement("div");
      row.className = "option-row";

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = true;
      checkbox.id = `${wheel.id}_opt_${index}`;

      const label = document.createElement("label");
      label.setAttribute("for", checkbox.id);
      label.textContent = move;

      row.appendChild(checkbox);
      row.appendChild(label);
      optionsList.appendChild(row);
    });

    const resultDiv = document.createElement("div");
    resultDiv.className = "result";
    resultDiv.id = wheel.id + "_result";

    card.appendChild(header);
    card.appendChild(optionsList);
    card.appendChild(resultDiv);
    wheelsContainer.appendChild(card);

    selectAllToggle.addEventListener("click", () => {
      const checkboxes = optionsList.querySelectorAll("input[type='checkbox']");
      const anyUnchecked = Array.from(checkboxes).some(cb => !cb.checked);
      checkboxes.forEach(cb => cb.checked = anyUnchecked);
      selectAllToggle.textContent = anyUnchecked ? "All off" : "All on";
    });
  });

  const spinButton = document.getElementById("spinButton");
  const lineOutput = document.getElementById("lineOutput");

  let isSpinning = false;

  function spinWheels() {
    if (isSpinning) return; // prevent spam clicks

    const enabledPerWheel = [];

    // Collect enabled moves for each wheel; bail if any wheel has none
    for (const wheel of wheelsData) {
      const card = document.querySelector(`.wheel-card[data-wheel-id="${wheel.id}"]`);
      const checkboxes = card.querySelectorAll("input[type='checkbox']");
      const enabledMoves = [];

      checkboxes.forEach((cb, index) => {
        if (cb.checked) enabledMoves.push(wheel.options[index]);
      });

      if (enabledMoves.length === 0) {
        lineOutput.textContent = `No moves selected on "${wheel.title}".`;
        return;
      }

      enabledPerWheel.push(enabledMoves);
    }

    isSpinning = true;
    spinButton.disabled = true;

    const spinDuration = 1200; // ms total spin time
    const interval = 80;       // ms between frames
    const startTime = Date.now();

    const spinner = setInterval(() => {
      const elapsed = Date.now() - startTime;

      // Show random combo while spinning
      const tempMoves = enabledPerWheel.map(moves =>
        moves[Math.floor(Math.random() * moves.length)]
      );

      lineOutput.innerHTML =
        tempMoves.map(m => `<span>${m}</span>`).join("➜");

      if (elapsed >= spinDuration) {
        clearInterval(spinner);

        // Final actual result
        const finalMoves = enabledPerWheel.map(moves =>
          moves[Math.floor(Math.random() * moves.length)]
        );

        lineOutput.innerHTML =
          finalMoves.map(m => `<span>${m}</span>`).join("➜");

        isSpinning = false;
        spinButton.disabled = false;
      }
    }, interval);
  }

  spinButton.addEventListener("click", spinWheels);

  // PWA: register service worker (for offline + app-y feel)
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("sw.js").catch(err => {
        console.log("SW registration failed:", err);
      });
    });
  }
</script>

</body>
</html>
